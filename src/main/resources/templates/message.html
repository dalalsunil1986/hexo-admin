<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>hexo-admin</title>
    <link rel="stylesheet" th:href="@{../lib/mdui/css/mdui.min.css}">
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-pink">
<header th:replace="common :: header"></header>
<nav th:replace="common :: nav"></nav>
<section class="mdui-container">
    <button onclick="server()" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent">hexo server</button>
    <button onclick="closeNow()" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent">强制关闭</button>
    <div class="mdui-table-fluid">
        <table class="mdui-table mdui-table-hoverable">
            <thead>
            <tr>
                <th style="min-width: 2000px">服务器消息</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td id="message_here"></td>
            </tr>
            </tbody>
        </table>
    </div>
</section>
<script th:src="@{../lib/jquery/jquery.min.js}"></script>
<script th:src="@{../lib/mdui/js/mdui.min.js}"></script>
<script th:src="@{./js/common.js}"></script>
<script>
    let $messageHere = $("#message_here");
    let ws = new WebSocket("ws://localhost:8080/command?a=1");

    function server() {
        $.get("/sendMsg?msg=server");
    }

    function closeNow() {
        $.get("/sendMsg?msg=close_now");
    }

    ws.onopen = function (evt) {
        $messageHere.append("Connection open ...<br/>");
        ws.send("connect");
    };

    ws.onmessage = function (evt) {
        $messageHere.append(evt.data + "<br/>");
        //ws.close();
    };

    ws.onclose = function (evt) {
        $messageHere.append("Connection closed.<br/>");
    };
</script>
</body>
</html>